<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rentify â€“ Login</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Plus Jakarta Sans', 'sans-serif'],
            display: ['Plus Jakarta Sans', 'sans-serif'],
          },
          colors: {
            rentify: {
              black: '#0f172a',
              green: '#047857',
            },
          },
        },
      },
    };
  </script>

  <style>
    body {
      background-color: #f8fafc;
      color: #0f172a;
      overflow-x: hidden;
    }

    .video-background {
      position: fixed;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      z-index: -10;
      transform: translate(-50%, -50%);
      object-fit: cover;
      opacity: 0.05;
    }

    .glass-panel {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.05);
    }

    .input-premium {
      background: #f1f5f9;
      border: 1px solid transparent;
      color: #0f172a;
      transition: all 0.2s ease;
    }

    .input-premium:focus {
      outline: none;
      background: #ffffff;
      border-color: #0f172a;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.05);
    }
    
    .input-premium::placeholder {
        color: #94a3b8;
    }

    #toast {
      opacity: 0;
      pointer-events: none;
      transition: opacity 200ms ease, transform 200ms ease;
      transform: translateY(10px);
    }

    #toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col relative">

  <video autoplay muted loop playsinline class="video-background" id="bg-video">
    <source src="Video_Generation_Request.mp4" type="video/mp4" />
  </video>
  
  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-full bg-slate-900 shadow-xl text-sm flex items-center gap-3">
    <i id="toast-icon" class="fa-solid fa-circle-info text-blue-400"></i>
    <span id="toast-message" class="text-white font-medium"></span>
  </div>

  <main class="relative z-10 flex-grow flex flex-col items-center justify-center px-4 py-10 w-full max-w-6xl mx-auto">
    
    <section id="role-view" class="glass-panel rounded-3xl px-8 py-10 md:px-14 md:py-16 w-full max-w-3xl">
      <div class="flex flex-col mb-8">
        <div class="flex items-center gap-2 mb-2">
             <i class="fa-solid fa-basket-shopping text-emerald-600 text-2xl"></i>
             <span class="font-bold text-xl tracking-tight text-slate-900">Rentify.</span>
        </div>
        <h1 id="welcome-heading" class="font-display text-3xl md:text-4xl font-extrabold text-slate-900 mt-2">Welcome to Rentify</h1>
      </div>

      <p class="text-slate-500 mb-8 font-medium">
        How would you like to proceed with <span id="display-email" class="text-slate-900 font-bold underline decoration-emerald-500 decoration-2">your account</span>?
      </p>

      <div class="grid md:grid-cols-2 gap-6">
        <button id="btn-role-partner" class="group relative overflow-hidden rounded-2xl border border-gray-200 bg-white p-6 text-left hover:border-slate-900 hover:shadow-lg transition-all duration-300">
          <div class="relative flex flex-col gap-4">
            <div class="w-12 h-12 rounded-full bg-gray-100 group-hover:bg-slate-900 transition-colors flex items-center justify-center text-slate-900 group-hover:text-white">
              <i class="fa-solid fa-briefcase text-xl"></i>
            </div>
            <div>
              <h3 class="font-bold text-lg mb-1 text-slate-900">Partner / Owner</h3>
              <p class="text-sm text-slate-500">List electronics, tools, and manage inventory for rentals.</p>
            </div>
          </div>
        </button>

        <button id="btn-role-customer" class="group relative overflow-hidden rounded-2xl border border-gray-200 bg-white p-6 text-left hover:border-emerald-600 hover:shadow-lg transition-all duration-300">
          <div class="relative flex flex-col gap-4">
            <div class="w-12 h-12 rounded-full bg-gray-100 group-hover:bg-emerald-600 transition-colors flex items-center justify-center text-slate-900 group-hover:text-white">
              <i class="fa-solid fa-user text-xl"></i>
            </div>
            <div>
              <h3 class="font-bold text-lg mb-1 text-slate-900">Customer</h3>
              <p class="text-sm text-slate-500">Rent verified equipment for your project.</p>
            </div>
          </div>
        </button>
      </div>

      <button id="btn-back-email" class="mt-8 text-xs font-bold text-slate-400 hover:text-slate-900 flex items-center gap-2 transition">
        <i class="fa-solid fa-arrow-left"></i> Back to email landing
      </button>
    </section>

    <section id="partner-auth" class="hidden glass-panel rounded-3xl px-6 py-8 md:px-12 md:py-12 w-full max-w-xl">
      <div class="flex items-center justify-between mb-8 border-b border-gray-100 pb-4">
        <div>
          <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-1">Partner Access</p>
          <h2 class="font-display text-2xl font-extrabold text-slate-900">Partner / Owner</h2>
        </div>
        <button id="btn-close-partner" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-slate-500 transition"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="flex mb-8 bg-gray-100 p-1.5 rounded-full">
        <button id="tab-partner-login" class="flex-1 py-2.5 rounded-full text-sm font-bold bg-white text-slate-900 shadow-sm">Login</button>
        <button id="tab-partner-register" class="flex-1 py-2.5 rounded-full text-sm font-bold text-slate-500 hover:text-slate-700">Register</button>
      </div>

      <div id="partner-login-view">
        <div class="space-y-5 mb-6">
          <input id="partner-login-email" type="email" class="w-full h-12 rounded-xl px-4 input-premium font-medium" placeholder="Email" />
          <input id="partner-login-password" type="password" class="w-full h-12 rounded-xl px-4 input-premium font-medium" placeholder="Password" />
          <div class="text-right mt-1">
            <a href="#" onclick="forgotPassword('partner-login-email')" class="text-xs text-slate-500 hover:text-slate-900 underline">Forgot Password?</a>
          </div>
        </div>
        <button id="btn-partner-login" class="w-full h-12 rounded-xl bg-slate-900 hover:bg-black text-white font-bold transition">Login</button>
        <button id="btn-partner-google" class="w-full h-12 rounded-xl border-2 border-gray-200 hover:border-slate-300 hover:bg-gray-50 text-slate-700 font-bold flex items-center justify-center gap-3 transition">
          <i class="fa-brands fa-google text-lg"></i> Continue with Google
        </button>
      </div>

      <div id="partner-register-view" class="hidden">
        <div class="space-y-4 mb-6 text-left">
          <div class="relative">
            <input id="partner-reg-email" type="email" required class="w-full h-11 rounded-lg px-4 input-premium pr-10" placeholder="Email" oninput="validateField('partner-reg-email', 'email')" />
            <span id="partner-reg-email-icon" class="absolute right-3 top-2.5 hidden"></span>
            <p id="partner-reg-email-msg" class="text-[10px] text-rose-500 mt-1 hidden"></p>
          </div>
          <input id="partner-reg-password" type="password" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Password (>5 chars, @, Num, Cap)" />
          <input id="partner-reg-name" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Full Name" />
          <div class="relative">
            <input id="partner-reg-phone" type="tel" required class="w-full h-11 rounded-lg px-4 input-premium pr-10" placeholder="Phone (10 digits)" oninput="validateField('partner-reg-phone', 'phone')" />
            <span id="partner-reg-phone-icon" class="absolute right-3 top-2.5 hidden"></span>
            <p id="partner-reg-phone-msg" class="text-[10px] text-rose-500 mt-1 hidden"></p>
          </div>
          <input id="partner-reg-address1" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Address" />
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <input id="partner-reg-city" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="City" />
            <input id="partner-reg-state" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="State" />
            <input id="partner-reg-pin" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="PIN" />
          </div>
        </div>
        <button id="btn-partner-register" class="w-full h-12 rounded-xl bg-slate-900 hover:bg-black text-white font-bold transition">Create Partner Account</button>
      </div>
    </section>

    <section id="customer-auth" class="hidden glass-panel rounded-3xl px-6 py-8 md:px-12 md:py-12 w-full max-w-xl">
      <div class="flex items-center justify-between mb-8 border-b border-gray-100 pb-4">
        <div>
          <p class="text-xs font-bold uppercase tracking-widest text-emerald-600 mb-1">Customer Access</p>
          <h2 class="font-display text-2xl font-extrabold text-slate-900">Rent Products</h2>
        </div>
        <button id="btn-close-customer" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-slate-500 transition"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="flex mb-8 bg-gray-100 p-1.5 rounded-full">
        <button id="tab-customer-login" class="flex-1 py-2.5 rounded-full text-sm font-bold bg-white text-emerald-700 shadow-sm">Login</button>
        <button id="tab-customer-register" class="flex-1 py-2.5 rounded-full text-sm font-bold text-slate-500 hover:text-slate-700">Register</button>
      </div>

      <div id="customer-login-view">
        <div class="space-y-5 mb-6">
          <input id="customer-login-email" type="email" class="w-full h-12 rounded-xl px-4 input-premium font-medium" placeholder="Email" />
          <input id="customer-login-password" type="password" class="w-full h-12 rounded-xl px-4 input-premium font-medium" placeholder="Password" />
          <div class="text-right mt-1">
            <a href="#" onclick="forgotPassword('customer-login-email')" class="text-xs text-slate-500 hover:text-emerald-700 underline">Forgot Password?</a>
          </div>
        </div>
        <button id="btn-customer-login" class="w-full h-12 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-bold transition">Login</button>
        <button id="btn-customer-google" class="w-full h-12 rounded-xl border-2 border-gray-200 hover:border-slate-300 hover:bg-gray-50 text-slate-700 font-bold flex items-center justify-center gap-3 transition">
          <i class="fa-brands fa-google text-lg"></i> Continue with Google
        </button>
      </div>

      <div id="customer-register-view" class="hidden">
        <div class="space-y-4 mb-6 text-left">
          <div class="relative">
            <input id="customer-reg-email" type="email" required class="w-full h-11 rounded-lg px-4 input-premium pr-10" placeholder="Email" oninput="validateField('customer-reg-email', 'email')" />
            <span id="customer-reg-email-icon" class="absolute right-3 top-2.5 hidden"></span>
            <p id="customer-reg-email-msg" class="text-[10px] text-rose-500 mt-1 hidden"></p>
          </div>
          <input id="customer-reg-password" type="password" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Password (>5 chars, @, Num, Cap)" />
          <input id="customer-reg-name" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Full Name" />
          <div class="relative">
            <input id="customer-reg-phone" type="tel" required class="w-full h-11 rounded-lg px-4 input-premium pr-10" placeholder="Phone (10 digits)" oninput="validateField('customer-reg-phone', 'phone')" />
            <span id="customer-reg-phone-icon" class="absolute right-3 top-2.5 hidden"></span>
            <p id="customer-reg-phone-msg" class="text-[10px] text-rose-500 mt-1 hidden"></p>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <input id="customer-reg-country" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="Country" />
            <input id="customer-reg-state" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="State" />
            <input id="customer-reg-city" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="City" />
          </div>
          <input id="customer-reg-pin" type="text" class="w-full h-11 rounded-lg px-4 input-premium" placeholder="PIN / ZIP" />
        </div>
        <button id="btn-customer-register" class="w-full h-12 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-bold transition">Create Customer Account</button>
      </div>
    </section>
  </main>

  <script type="module" src="firebase-config.js"></script>

  <script>
    // --- REAL-TIME VALIDATION LOGIC ---
    window.validateField = (id, type) => {
        const input = document.getElementById(id);
        const icon = document.getElementById(id + '-icon');
        const msg = document.getElementById(id + '-msg');
        const val = input.value.trim();
        let isValid = false;
        let errorMessage = "";

        if (type === 'email') {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            isValid = emailRegex.test(val);
            errorMessage = "Please enter a valid email address.";
        } else if (type === 'phone') {
            const phoneRegex = /^[6-9]\d{9}$/; 
            isValid = phoneRegex.test(val);
            errorMessage = "Enter a valid 10-digit number.";
        }

        if (val === "") {
            icon.classList.add('hidden');
            msg.classList.add('hidden');
            input.classList.remove('border-emerald-500', 'border-rose-500');
        } else if (isValid) {
            icon.innerHTML = '<i class="fa-solid fa-circle-check text-emerald-500"></i>';
            icon.classList.remove('hidden');
            msg.classList.add('hidden');
            input.classList.add('border-emerald-500');
            input.classList.remove('border-rose-500');
        } else {
            icon.innerHTML = '<i class="fa-solid fa-circle-xmark text-rose-500"></i>';
            icon.classList.remove('hidden');
            msg.innerText = errorMessage;
            msg.classList.remove('hidden');
            input.classList.add('border-rose-500');
            input.classList.remove('border-emerald-500');
        }
        return isValid;
    };

    const CUSTOMER_PRODUCTS_URL = 'products.html';
    const PARTNER_DASHBOARD_URL = 'partner-dashboard.html';

    function setWelcomeName(emailString) {
        const header = document.getElementById('welcome-heading');
        const displayEmail = document.getElementById('display-email');
        if (!emailString || !emailString.includes('@')) {
            header.textContent = "Welcome to Rentify";
            displayEmail.textContent = "your account";
            return;
        }
        const namePart = emailString.split('@')[0];
        const formattedName = namePart.charAt(0).toUpperCase() + namePart.slice(1);
        header.textContent = `Welcome, ${formattedName}`;
        displayEmail.textContent = emailString;
    }

    function validatePassword(password) {
        if(password.length <= 5) return false;
        if(!/[A-Z]/.test(password)) return false;
        if(!/\d/.test(password)) return false;
        if(!/@/.test(password)) return false;
        return true;
    }

    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const msg = document.getElementById('toast-message');
      const icon = document.getElementById('toast-icon');
      msg.textContent = message;
      icon.className = 'fa-solid';
      if (type === 'success') icon.classList.add('fa-circle-check', 'text-emerald-400');
      else if (type === 'error') icon.classList.add('fa-circle-xmark', 'text-rose-400');
      else icon.classList.add('fa-circle-info', 'text-blue-400');
      toast.classList.add('show');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => toast.classList.remove('show'), 4000);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const auth = window.firebaseAuth;
      const helpers = window.firebaseHelpers || {};
      const db = window.firebaseDb;

      if (!auth || !helpers) return;

      const { signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, sendEmailVerification, sendPasswordResetEmail, signOut, googleProvider, doc, setDoc, serverTimestamp } = helpers;

      const urlParams = new URLSearchParams(window.location.search);
      const emailFromLanding = urlParams.get('email');
      if (emailFromLanding) {
          setWelcomeName(emailFromLanding);
          document.getElementById('partner-login-email').value = emailFromLanding;
          document.getElementById('customer-login-email').value = emailFromLanding;
      }

      window.forgotPassword = async (inputId) => {
          const email = document.getElementById(inputId).value.trim();
          if(!email) { showToast("Enter your email first", "error"); return; }
          try {
              await sendPasswordResetEmail(auth, email);
              showToast("Reset link sent! Check email.", "success");
          } catch(e) { showToast(e.message, "error"); }
      };

      auth.onAuthStateChanged(user => {
        if (user) {
            let displayName = user.displayName || user.email.split('@')[0];
            displayName = displayName.charAt(0).toUpperCase() + displayName.slice(1);
            document.getElementById('welcome-heading').textContent = `Welcome, ${displayName}`;
        }
      });

      function backToRoleView() {
          document.getElementById('partner-auth').classList.add('hidden');
          document.getElementById('customer-auth').classList.add('hidden');
          document.getElementById('role-view').classList.remove('hidden');
      }

      document.getElementById('btn-role-partner').onclick = () => { document.getElementById('role-view').classList.add('hidden'); document.getElementById('partner-auth').classList.remove('hidden'); };
      document.getElementById('btn-role-customer').onclick = () => { document.getElementById('role-view').classList.add('hidden'); document.getElementById('customer-auth').classList.remove('hidden'); };
      document.getElementById('btn-close-partner').onclick = backToRoleView;
      document.getElementById('btn-close-customer').onclick = backToRoleView;

      document.getElementById('tab-partner-login').onclick = () => { document.getElementById('partner-login-view').classList.remove('hidden'); document.getElementById('partner-register-view').classList.add('hidden'); };
      document.getElementById('tab-partner-register').onclick = () => { document.getElementById('partner-register-view').classList.remove('hidden'); document.getElementById('partner-login-view').classList.add('hidden'); };
      document.getElementById('tab-customer-login').onclick = () => { document.getElementById('customer-login-view').classList.remove('hidden'); document.getElementById('customer-register-view').classList.add('hidden'); };
      document.getElementById('tab-customer-register').onclick = () => { document.getElementById('customer-register-view').classList.remove('hidden'); document.getElementById('customer-login-view').classList.add('hidden'); };

      async function handleLogin(emailId, passId, redirect) {
        const email = document.getElementById(emailId).value.trim();
        const pass = document.getElementById(passId).value.trim();
        try {
          const cred = await signInWithEmailAndPassword(auth, email, pass);
          if (!cred.user.emailVerified) { await signOut(auth); return showToast('Verify email first', 'error'); }
          showToast('Login Success!', 'success');
          setTimeout(() => location.href = redirect, 1200);
        } catch (e) { showToast(e.message, 'error'); }
      }

      async function handleRegister(emailId, passId, nameId, collection) {
        const email = document.getElementById(emailId).value.trim();
        const pass = document.getElementById(passId).value.trim();
        const name = document.getElementById(nameId).value.trim();
        const phoneId = collection === 'partners' ? 'partner-reg-phone' : 'customer-reg-phone';
        const phone = document.getElementById(phoneId).value.trim();

        if (!validateField(emailId, 'email') || !validateField(phoneId, 'phone')) {
            showToast("Please enter a valid email and phone number", "error");
            return;
        }

        try {
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await sendEmailVerification(cred.user);
          await setDoc(doc(db, collection, cred.user.uid), { email, name, phone, createdAt: serverTimestamp() }, { merge: true });
          await signOut(auth);
          showToast('Check email to verify!', 'success');
        } catch (e) { showToast(e.message, 'error'); }
      }

      async function handleGoogleLogin(collection, redirect) {
        try {
            const res = await signInWithPopup(auth, googleProvider);
            await setDoc(doc(db, collection, res.user.uid), {
                email: res.user.email,
                name: res.user.displayName,
                provider: "google",
                lastLogin: serverTimestamp()
            }, { merge: true });
            showToast("Google login successful", "success");
            setTimeout(() => location.href = redirect, 1200);
        } catch (e) { showToast(e.message, "error"); }
      }

      document.getElementById('btn-partner-login').onclick = () => handleLogin('partner-login-email', 'partner-login-password', PARTNER_DASHBOARD_URL);
      document.getElementById('btn-customer-login').onclick = () => handleLogin('customer-login-email', 'customer-login-password', CUSTOMER_PRODUCTS_URL);
      document.getElementById('btn-partner-register').onclick = () => handleRegister('partner-reg-email', 'partner-reg-password', 'partner-reg-name', 'partners');
      document.getElementById('btn-customer-register').onclick = () => handleRegister('customer-reg-email', 'customer-reg-password', 'customer-reg-name', 'customers');
      
      document.getElementById('btn-partner-google').onclick = () => handleGoogleLogin('partners', PARTNER_DASHBOARD_URL);
      document.getElementById('btn-customer-google').onclick = () => handleGoogleLogin('customers', CUSTOMER_PRODUCTS_URL);
      document.getElementById('btn-back-email').onclick = () => window.location.href = 'index.html';
    });
  </script>
</body>
</html>