<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rentify - Partner Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F8FAFC; color: #1F2937; }
    
    /* Fireart UI Styling */
    .btn-primary { background-color: #10B981; color: white; transition: all 0.2s; }
    .btn-primary:hover { background-color: #059669; transform: translateY(-1px); }
    
    .card-stat { background: white; border: 1px solid #E5E7EB; border-radius: 16px; padding: 20px; transition: all 0.3s; }
    .card-stat:hover { box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
    
    .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; color: #6B7280; font-weight: 500; transition: all 0.2s; }
    .sidebar-link:hover { background-color: #F3F4F6; color: #111827; }
    .sidebar-link.active { background-color: #ECFDF5; color: #059669; font-weight: 600; }
    
    /* Smooth Scroll */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #E5E7EB; border-radius: 10px; }
  </style>
</head>
<body class="flex h-screen overflow-hidden">

  <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col p-6 z-20">
    <div class="flex items-center gap-3 mb-8">
        <div class="w-8 h-8 bg-green-100 text-green-600 rounded-lg flex items-center justify-center font-bold text-xl">R</div>
        <span class="font-bold text-xl tracking-tight text-gray-900">Rentify</span>
    </div>

    <nav class="flex-1 space-y-1">
        <button onclick="switchTab('overview')" id="nav-overview" class="sidebar-link active w-full">
            <i class="fa-solid fa-grid-2"></i> Dashboard
        </button>
        <button onclick="switchTab('tracking')" id="nav-tracking" class="sidebar-link w-full">
            <i class="fa-solid fa-map-location-dot"></i> Live Tracking
        </button>
        <button onclick="switchTab('products')" id="nav-products" class="sidebar-link w-full">
            <i class="fa-solid fa-box"></i> Products
        </button>
        <button onclick="switchTab('plans')" id="nav-plans" class="sidebar-link w-full">
            <i class="fa-solid fa-crown"></i> Subscription
        </button>
    </nav>

    <div class="mt-auto pt-6 border-t border-gray-100">
        <button id="btn-logout" class="sidebar-link w-full text-red-500 hover:bg-red-50 hover:text-red-600">
            <i class="fa-solid fa-arrow-right-from-bracket"></i> Logout
        </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col h-screen relative overflow-hidden">
    <header class="h-20 bg-white/80 backdrop-blur-md border-b border-gray-200 flex items-center justify-between px-8 sticky top-0 z-10">
        <div>
            <h1 class="text-xl font-bold text-gray-900" id="page-title">Dashboard</h1>
            <p class="text-xs text-gray-500">Overview of your rental business</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 rounded-full border border-green-100">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-xs font-bold text-green-700" id="plan-badge">FREE PLAN</span>
            </div>
            <button onclick="openAddModal()" class="btn-primary px-5 py-2.5 rounded-full font-medium shadow-lg shadow-green-200 flex items-center gap-2">
                <i class="fa-solid fa-plus"></i> <span class="hidden sm:inline">Add Product</span>
            </button>
        </div>
    </header>

    <div class="flex-1 overflow-y-auto p-8 pb-20 space-y-8" id="main-container">
        
        <div id="tab-overview" class="space-y-6 animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-[#10B981] text-white p-6 rounded-2xl shadow-xl shadow-green-200 relative overflow-hidden card-stat">
                    <div class="flex justify-between items-start mb-2 relative z-10">
                        <span class="text-sm font-medium opacity-90">Total Products</span>
                        <div class="bg-white/20 p-2 rounded-lg"><i class="fa-solid fa-box"></i></div>
                    </div>
                    <h2 class="text-4xl font-bold relative z-10" id="stat-products">0</h2>
                </div>
                <div class="card-stat">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm font-bold text-gray-500">Active Rentals</span>
                        <div class="bg-blue-50 text-blue-600 p-2 rounded-lg"><i class="fa-solid fa-bolt"></i></div>
                    </div>
                    <h2 class="text-4xl font-bold text-gray-800" id="stat-active">0</h2>
                </div>
                <div class="card-stat">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm font-bold text-gray-500">Earnings</span>
                        <div class="bg-green-50 text-green-600 p-2 rounded-lg"><i class="fa-solid fa-wallet"></i></div>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800">₹<span id="stat-earnings">0</span></h2>
                </div>
                <div class="card-stat">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm font-bold text-gray-500">Pending</span>
                        <div class="bg-orange-50 text-orange-600 p-2 rounded-lg"><i class="fa-regular fa-clock"></i></div>
                    </div>
                    <h2 class="text-4xl font-bold text-gray-800" id="stat-pending">0</h2>
                </div>
            </div>

            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h3 class="font-bold text-gray-800">Recent Bookings</h3>
                </div>
                <div id="tracking-list" class="divide-y divide-gray-100">
                    <div class="p-8 text-center text-gray-400 text-sm">Loading data...</div>
                </div>
            </div>
        </div>

        <div id="tab-tracking" class="hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 h-[600px] flex items-center justify-center relative overflow-hidden">
                <div class="absolute inset-0 bg-slate-50 flex items-center justify-center">
                    <div class="text-center opacity-50">
                        <i class="fa-solid fa-map-location-dot text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 font-medium">Select an active rental from the Overview to track.</p>
                    </div>
                </div>
                <div id="map-overlay" class="hidden absolute top-6 left-6 right-6 md:w-96 bg-white/90 backdrop-blur shadow-2xl rounded-xl p-6 border border-white/50">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-lg text-gray-900" id="track-product">Product Name</h4>
                            <p class="text-xs text-gray-500" id="track-id">#ID</p>
                        </div>
                        <span class="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded">LIVE</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex gap-3">
                            <div class="w-8 h-8 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center"><i class="fa-solid fa-user"></i></div>
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase">Customer</p>
                                <p class="text-sm font-bold text-gray-800" id="track-cust-name">-</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <div class="w-8 h-8 bg-orange-50 text-orange-600 rounded-full flex items-center justify-center"><i class="fa-solid fa-location-dot"></i></div>
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase">Address</p>
                                <p class="text-sm text-gray-600" id="track-cust-address">-</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-products" class="hidden">
            <div id="products-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>

        <div id="tab-plans" class="hidden">
            <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto pt-4">
                <div class="bg-white p-8 rounded-3xl border border-gray-200">
                    <h3 class="font-bold text-2xl text-gray-800">Free</h3>
                    <p class="text-4xl font-bold mt-4 mb-6">₹0</p>
                    <ul class="text-sm text-gray-600 space-y-3 mb-8">
                        <li><i class="fa-solid fa-check text-green-500 mr-2"></i> Standard Theme</li>
                        <li><i class="fa-solid fa-check text-green-500 mr-2"></i> 5 Listings</li>
                    </ul>
                    <button class="w-full py-3 bg-gray-100 text-gray-400 rounded-xl font-bold cursor-not-allowed">Current Plan</button>
                </div>
                <div class="bg-[#1F2937] text-white p-8 rounded-3xl shadow-2xl relative transform scale-105">
                    <div class="absolute top-0 right-0 bg-[#10B981] text-white text-xs font-bold px-4 py-1 rounded-bl-xl">POPULAR</div>
                    <h3 class="font-bold text-2xl">Growth</h3>
                    <p class="text-4xl font-bold mt-4 mb-6">₹499 <span class="text-sm font-normal text-gray-400">/mo</span></p>
                    <ul class="text-sm text-gray-300 space-y-3 mb-8">
                        <li><i class="fa-solid fa-check text-green-400 mr-2"></i> Live Tracking</li>
                        <li><i class="fa-solid fa-check text-green-400 mr-2"></i> Custom Themes</li>
                        <li><i class="fa-solid fa-check text-green-400 mr-2"></i> 50 Listings</li>
                    </ul>
                    <button onclick="initiateRazorpay('Growth', 499)" class="w-full py-3 bg-[#10B981] hover:bg-[#059669] text-white rounded-xl font-bold transition">Upgrade Now</button>
                </div>
            </div>
        </div>

    </div>
  </main>

  <div id="modal-add" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-fade-in">
        <div class="flex justify-between items-center mb-6">
            <h3 class="font-bold text-lg text-gray-900">Add New Product</h3>
            <button onclick="closeAddModal()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <form id="form-add" class="space-y-4">
            <input type="text" id="inp-name" required placeholder="Product Name" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-green-500 outline-none">
            <div class="grid grid-cols-2 gap-4">
                <input type="number" id="inp-price" required placeholder="Rent (₹)" class="w-full p-3 border rounded-xl bg-gray-50">
                <select id="inp-category" class="w-full p-3 border rounded-xl bg-gray-50">
                    <option>Electronics</option><option>Cameras</option><option>Tools</option>
                </select>
            </div>
            <textarea id="inp-desc" rows="3" placeholder="Description..." class="w-full p-3 border rounded-xl bg-gray-50"></textarea>
            <input type="file" id="inp-file" accept="image/*" class="text-xs">
            <button type="submit" id="btn-publish" class="w-full py-3 bg-[#10B981] hover:bg-[#059669] text-white font-bold rounded-xl transition shadow-lg">Publish Item</button>
        </form>
    </div>
  </div>
  <script>
// ... inside confirmBooking ...
    window.confirmBooking = async () => {
        // FIX: No destructuring of 'helpers'
        const db = window.firebaseDb; 
        const helpers = window.firebaseHelpers; 

        const d1 = document.getElementById('date-start').value;
        const d2 = document.getElementById('date-end').value;
        const name = document.getElementById('cust-name').value;
        const address = document.getElementById('cust-address').value;

        if(!d1 || !d2 || !name) return alert("Fill all details!");

        const btn = document.getElementById('btn-pay');
        btn.innerHTML = 'Processing...'; btn.disabled = true;

        try {
            const date1 = new Date(d1);
            const date2 = new Date(d2);
            let days = Math.ceil((date2 - date1) / 86400000) || 1;
            const total = (days * selectedProduct.rentPerDay) + (selectedProduct.deposit || 0);

            await helpers.addDoc(helpers.collection(db, "bookings"), {
                productId: selectedProduct.id,
                productName: selectedProduct.name,
                partnerId: selectedProduct.partnerId,
                customerId: currentUser.uid,
                customerName: name, // Required for Dashboard
                customerAddress: address, // Required for Dashboard
                startDate: helpers.Timestamp.fromDate(date1),
                endDate: helpers.Timestamp.fromDate(date2),
                totalPrice: total, // Required for Earnings
                status: 'active',
                createdAt: helpers.serverTimestamp()
            });

            alert("Booking Confirmed!");
            closeRentModal();
        } catch(e) { alert("Error: " + e.message); } 
        finally { btn.innerHTML = 'Pay & Confirm'; btn.disabled = false; }
    };
    </script>
<script type="module" src="firebase-config.js"></script>
<script src="partner-dashboard.js"></script>
</body>
</html>